<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>My Project: inc/tilt_detection.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tilt_detection.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handles accelerometer data sampling.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;stm32f4xx_conf.h&quot;</code><br />
<code>#include &quot;lis302dl.h&quot;</code><br />
<code>#include &quot;arm_math.h&quot;</code><br />
</div>
<p><a href="tilt__detection_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa83e7efc0626b1c4d0be8683f3566a1d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#aa83e7efc0626b1c4d0be8683f3566a1d">calibrate</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:aa83e7efc0626b1c4d0be8683f3566a1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro to control calibration.  <a href="#aa83e7efc0626b1c4d0be8683f3566a1d">More...</a><br /></td></tr>
<tr class="separator:aa83e7efc0626b1c4d0be8683f3566a1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5abd28c44c29b7397c84f1fec4b1d84"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#af5abd28c44c29b7397c84f1fec4b1d84">ALPHA</a>&#160;&#160;&#160;(uint8_t)0</td></tr>
<tr class="memdesc:af5abd28c44c29b7397c84f1fec4b1d84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constant used to specify angle type as the pitch.  <a href="#af5abd28c44c29b7397c84f1fec4b1d84">More...</a><br /></td></tr>
<tr class="separator:af5abd28c44c29b7397c84f1fec4b1d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b996515309fc3c03449912bb33046e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#a1b996515309fc3c03449912bb33046e3">BETA</a>&#160;&#160;&#160;(uint8_t)1</td></tr>
<tr class="memdesc:a1b996515309fc3c03449912bb33046e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constant used to specify angle type as the roll.  <a href="#a1b996515309fc3c03449912bb33046e3">More...</a><br /></td></tr>
<tr class="separator:a1b996515309fc3c03449912bb33046e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac3507045f0e807781db279ae5f7069cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#ac3507045f0e807781db279ae5f7069cb">Accel_InitConfig</a> (uint8_t Power, uint8_t DataRate, uint8_t Axes, uint8_t FullScale, uint8_t SelfTest)</td></tr>
<tr class="memdesc:ac3507045f0e807781db279ae5f7069cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the mems configurations.  <a href="#ac3507045f0e807781db279ae5f7069cb">More...</a><br /></td></tr>
<tr class="separator:ac3507045f0e807781db279ae5f7069cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5616db99ad9b444ea75a23a0811f65f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#ab5616db99ad9b444ea75a23a0811f65f">calibrateSensor</a> (void)</td></tr>
<tr class="memdesc:ab5616db99ad9b444ea75a23a0811f65f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrate the sensor.  <a href="#ab5616db99ad9b444ea75a23a0811f65f">More...</a><br /></td></tr>
<tr class="separator:ab5616db99ad9b444ea75a23a0811f65f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0342d87d11ee1830125b671f206d4231"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#a0342d87d11ee1830125b671f206d4231">normalize</a> (int32_t *data, float *result)</td></tr>
<tr class="memdesc:a0342d87d11ee1830125b671f206d4231"><td class="mdescLeft">&#160;</td><td class="mdescRight">Normalize the accelerometer data.  <a href="#a0342d87d11ee1830125b671f206d4231">More...</a><br /></td></tr>
<tr class="separator:a0342d87d11ee1830125b671f206d4231"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e745d3b2730c451ac36864225b3bd56"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#a8e745d3b2730c451ac36864225b3bd56">getTilt</a> (uint8_t type, float xyz[])</td></tr>
<tr class="memdesc:a8e745d3b2730c451ac36864225b3bd56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the tilt of the board.  <a href="#a8e745d3b2730c451ac36864225b3bd56">More...</a><br /></td></tr>
<tr class="separator:a8e745d3b2730c451ac36864225b3bd56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb1495a9af25fd7ebb45836ea0e35f83"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tilt__detection_8h.html#adb1495a9af25fd7ebb45836ea0e35f83">tiltCorrection</a> (float tilt, float inputTilt, uint8_t *currentTiltType)</td></tr>
<tr class="memdesc:adb1495a9af25fd7ebb45836ea0e35f83"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicate the direction to rotate the board to match a desired tilt angle.  <a href="#adb1495a9af25fd7ebb45836ea0e35f83">More...</a><br /></td></tr>
<tr class="separator:adb1495a9af25fd7ebb45836ea0e35f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handles accelerometer data sampling. </p>
<p>Assumes usage of the LIS302DL MEMS sensor Includes functions to normalize the raw data from the sensor and calculate the tilt angle based on acceleration values along the three axes.</p>
<dl class="section date"><dt>Date</dt><dd>2015/03/12 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="af5abd28c44c29b7397c84f1fec4b1d84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALPHA&#160;&#160;&#160;(uint8_t)0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constant used to specify angle type as the pitch. </p>

</div>
</div>
<a class="anchor" id="a1b996515309fc3c03449912bb33046e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BETA&#160;&#160;&#160;(uint8_t)1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constant used to specify angle type as the roll. </p>

</div>
</div>
<a class="anchor" id="aa83e7efc0626b1c4d0be8683f3566a1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define calibrate&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Macro to control calibration. </p>
<p>Used to control offline calibration. Set calibrate to 1 to enable calibration at startup. Set calibrate to 0 to use calibration parameters previously acquired.</p>
<p>Calibrate should be set to 0 since <a class="el" href="tilt__detection_8h.html#ab5616db99ad9b444ea75a23a0811f65f">calibrateSensor</a> does not include functionality to collect new data for the 6 positions along the axes. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac3507045f0e807781db279ae5f7069cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Accel_InitConfig </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>Power</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>DataRate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>Axes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>FullScale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>SelfTest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the mems configurations. </p>
<p>The function activates writing to the status registers when Data Ready.</p>
<p>Power Power Mode of the sensor  DataRate  Axes  FullScale  SelfTest </p>

</div>
</div>
<a class="anchor" id="ab5616db99ad9b444ea75a23a0811f65f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calibrateSensor </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrate the sensor. </p>
<p>Uses the relation X = inverse( transpose(w) * w ) * transpose(w) * Y and solves for X. Y is the predefined values along +/- x, y, z axes. W is acquired data corresponding to the positions in Y. X is the calibrated normalization matrix values.</p>
<p><a class="el" href="tilt__detection_8h.html#aa83e7efc0626b1c4d0be8683f3566a1d">calibrate</a> must have value of 1 in order to calibrate </p>

</div>
</div>
<a class="anchor" id="a8e745d3b2730c451ac36864225b3bd56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float getTilt </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xyz</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the tilt of the board. </p>
<p>type Specify alpha or beta tilt.  xyz the acceleration values for x, y, and z respectively </p><dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Return</td><td>the tilt angle </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0342d87d11ee1830125b671f206d4231"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize </td>
          <td>(</td>
          <td class="paramtype">int32_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Normalize the accelerometer data. </p>
<p>Apply the calibration parameters to the data to scale to 1g. Uses the relation Y = w * X to solve for Y, where Y is the normalized data, w is the accelerometer raw data, X is the normalization matrix stored in calParams.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>The accelerometer data </td></tr>
    <tr><td class="paramname">result</td><td>The normalized data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="adb1495a9af25fd7ebb45836ea0e35f83"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t tiltCorrection </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tilt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>inputTilt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>currentTiltType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicate the direction to rotate the board to match a desired tilt angle. </p>
<p>If the board is calculating the pitch, up indicates raising the side opposite the USB link. If the board is calculating the roll, up indicates raising the side to the left of the USB link when looking into the link</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tilt</td><td>The board's current angle </td></tr>
    <tr><td class="paramname">inputTilt</td><td>The desired angle </td></tr>
    <tr><td class="paramname">currentTiltType</td><td>The tilt angle type. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>direction to tilt the board: 1 for up, -1 for down, 0 for matching. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 15 2015 16:11:23 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
